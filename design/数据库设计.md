# 数据库设计



### 任务信息表
```typescript
class  lct_task_info {
    taskID string
    taskName string
    isEnable int
    envID string
    isAutoRun int
    tags string
    createTime DateTime
    modifyTime DateTime
    createPerson string
    modifyPerson string
}
```


### 标签信息表
```typescript
class lct_tag_info {
    tagID string
    tagName string
    tagType string    // p0 / p1 / p2
    parentID string
    isEnable int 
    remark string
    createTime DateTime
    modifyTime DateTime
    createPerson string
    modifyPerson string
}
```


### 工作流信息表
```typescript
class tag {
    tagName string
    tagID string
}

class WFNodeConfig {
    retry int
    timeout string
}

class ExtractItem {
    fieldName string
    fieldValue string | Object | number | Array<any> | boolean
}

class WFNode {
    wfNodeID string
    apiId string
    config  WFNodeConfig
    extractList Array<ExtractItem>
    dependencyList Array<string>
    expectList Array<string>
}

class lct_workflow_info {
    workflowID string 
    workflowName string
    tags Array<tag>
    nodes Array<WFNode>
    createTime DateTime | string
    modifyTime DateTime | string
    createPerson string
    modifyPerson string
}
```

### 预期断言信息表
```typescript
class Items {
    description string       // 断言描述
    fieldName string        // 断言的字段
    operation string        // 操作符 > | < | = | >= | <=
    desireValue string | number | boolean    // 预期结果
}

class lct_expect_info {
    expectID string
    apiID string
    expectType string
    expectItems Array<Items>
    createTime DateTime | string
    modifyTime DateTime | string
    createPerson string
    modifyPerson string
}
```


### 依赖信息表
```typescript
class lct_dependency_info {
    dependID string
    apiID string
    workflowID string
    dependItems Array<ExtractItem>
    createTime DateTime | string
    modifyTime DateTime | string
    createPerson string
    modifyPerson string
}
```

### 配置信息表 --- 废弃
```typescript
class ConfigItem {
    description string
    configName string
    configValue string    
}

class lct_config {
    configID string
    configType string
    configItems Array<ConfigItem>
    createTime DateTime | string
    modifyTime DateTime | string
    createPerson string
    modifyPerson string
}
```

### 测试数据表
```typescript
class lct_workflow_data {
    dataID string
    workflowID string
    items Array<Map<any,any>>
    isEnable int
    createTime DateTime | string
    modifyTime DateTime | string
    createPerson string
    modifyPerson string
}
```
### 工作流数据规则表
```typescript
class Condition {
    description string
    // 01 按长度生成字符串；
    // 02 根据枚举生成；
    // 03 从数据库获取
    // 04 生成电话
    // 05 生成邮箱
    // 06 生成身份证
    // 07 生成时间
    // 08 生成区间数字
    condType string
    
    // 01 生成的字符串的长度范围
    rangeLength? string
    charTypeList? Array<string>

    // 02 在给定的一个范围内枚举
    enumData? Array<string>

    // 03 获取数据库数据
    fetch? string
    
    // 07类型时间生成
    date? string
    isCurrent?: boolean
    
    // 08 生成的值的范围
    numberRange? string

}

class FieldRule {
    fieldName string   // requestBody.registInfo.phoneNumber
    fieldType string  // url, body
    rule Condition
}

class WFNodeRule {
    apiID string
    fieldRules Array<FieldRule>
}

class lct_data_rule {
    ruleID string
    workflowID string
    ruleItems Array<WFNodeRule>
    createTime DateTime | string
    modifyTime DateTime | string
    createPerson string
    modifyPerson string
}
```



### 环境信息表
```typescript
class Tag {
    tagName string
    tagID string
    tagType string
}
class lct_environment_info {
    envID string
    envName string
    domain string
    isEnable int
    tags Array<Tag>
}
```

### 接口元数据信息表
```typescript
class ApiQuery {
    name string
    value string
}

class lct_api_meta {
    apiID string
    apiDesc string
    apiURL string
    apiMethod string
    apiQuery Array<ApiQuery>
    apiHeaders Map<string,string>
    apiBody Map<string,any> | string
    tags Array<string>
}
```


### 工作流详情信息表
```typescript
class Tag {
    tagName string
    tagID string
    tagType string
}
class WFNode {
    wfNodeID string
    // 包含domain和地址请求参数
    apiUrl string
    apiMethod string
    data Map<string,any>
    config Map<string, any>
    apiHeader Map<string,string>
    apiBody? Map<string,any> | string
    expect Array<any>
    extract Array<any>
}
class lct_workflow_detail {
    workflowID string
    workflowName string
    tags Array<Tag>
    dataID Array<string>
    wfNodes Array<WFNode>
    createTime DateTime | string
    modifyTime DateTime | string
    createPerson string
    modifyPerson string
}
```

### 工作流运行记录
```typescript
class FailedDetail {
    prepare number | string
    localNetwork number | string
    getResponse string | number
    responseInvalid number | string
    verify number | string
}

class SuccessDetail {
    getResponse number | string
    verify number | string
}

class WorkFlowStatics {
    totalNum number
    successNum  number
    failNum     number
    duration    number | string
    failedDetail FailedDetail
    successDetail SuccessDetail
}
class ErrorInfo {
    httpCode int
    stage string
    error  Object
    message string
    stack Object
}

class WorkFlowNodeRunDetail {
    status int
    apiID string
    apiURL string
    apiMethod string
    apiBody Map<string,any>
    apiHeaders Map<string,string>
    data Map<string,any>
    config Map<string,any>
    response Map<string, any>
    error ErrorInfo
    
}

class lct_report {
    reportID string
    workflowID string
    taskID string
    iterData Map<string,any>
    iterNum int | string
    status int
    workflowStatics WorkFlowStatics
    workflowDetail Array<WorkFlowNodeRunDetail>
    createTime DateTime | string
    modifyTime DateTime | string

}
```
